<?php
/**
 * @file
 * Contains map_object_field.module.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function map_object_field_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the map_object_field module.
    case 'help.page.map_object_field':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Module provides the field which allows editors to draw shapes(circles, lines, polygons, polylines, markers, rectangles) on Maps.') . '</p>';
      return $output;

    default:
  }
}

/**
 * Implements hook_theme().
 */
function map_object_field_theme() {
  $theme = [
    'map_default_format' => [
      'variables' => [
        'name' => '',
        'overlays' => '',
        'mapOptions' => [
          'center-lat' => 0,
          'center-lng' => 0,
          'zoom' => 1,
        ],
        'mapWidth' => '100%',
        'mapHeight' => '400px',
      ],
      'template' => 'map_object_field_default',
    ],
    'map_default_widget_overlay_info_item' => [
      'variables' => [],
      'template' => 'map_default_widget_overlay_info_item',
    ],
    'map_default_widget_preview' => [
      'variables' => [
        'mapOptions' => [],
      ],
      'template' => 'map_default_widget_preview',
    ],
  ];

  return $theme;
}

/**
 * Implements hook_library_info_alter().
 */
function map_object_field_library_info_alter(&$libraries, $extension) {
  if ($extension == 'map_object_field') {
    $config = $config = \Drupal::config('map_object_field.settings');
    if ($google_map_api_key = $config->get('google_map_api_key')) {
      $libs = [
        'google-map-api',
        'google-map-api-async',
        'google-map-api-drawing',
      ];
      foreach ($libs as $lib) {
        $key = array_keys($libraries[$lib]['js'])[0];
        $new_key = $key . '&key=' . $google_map_api_key;
        $libraries[$lib]['js'] = [
          $new_key => $libraries[$lib]['js'][$key],
        ];
      }
    }
  }
}
